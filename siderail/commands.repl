(load-file "siderail/setup.repl")
(require '[clojure.xml :as xml])

(rustic/request-sub (rustic/get-connection) "akshatb42@gmail.com" "https://applieddivinitystudies.com/atom2.xml")

(rustic/register-sub (db-utils/get-connection) "akshatb42@gmail.com" "https://aksh-at.github.io/index.xml")
(lambdas/register-sub {:input (json/write-str {:email "a1", :feed-url "b1"}) })
(rustic/get-subs-by-email db "akshatb42@gmail.com" [:sub/feed-url])
(lambdas/get-subs-by-email {:input (json/write-str "a1-x")})

;; (rustic/sub-exists (db-utils/get-db) "akshatb42@gmail.com" "https://aksh-at.github.io/index.xml")

;; (find-last-date "http://blog.sigfpe.com/feed-url.xml")
(println (poller/find-last-date (xml/parse "https://byorgey.wordpress.com/feed/")))
(println (poller/find-last-date (xml/parse "https://ruslanspivak.com/feeds/all.atom.xml")))

(schema/reset-last-updated (db-utils/get-connection) "akshatb42@gmail.com" "https://aksh-at.github.io/index.xml")

(poller/poll-feed (db-utils/get-connection) ["akshatb42@gmail.com" "https://aksh-at.github.io/index.xml"])
